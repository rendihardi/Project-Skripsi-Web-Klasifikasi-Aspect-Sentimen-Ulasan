{% extends "base.html" %} {% block title %}Analyze by Text{% endblock %} {%
block content %}
<div class="max-w-2xl mx-auto mt-10 bg-white p-6 shadow-lg rounded-lg">
  <h2 class="text-xl font-bold text-gray-700 mb-4 text-center">
    Masukkan Ulasan Anda
  </h2>

  <!-- Input Review -->
  <textarea
    id="reviewText"
    class="w-full border-2 border-orange-500 p-3 rounded-lg focus:ring focus:ring-orange-300 focus:border-orange-600 shadow-md"
    rows="5"
    placeholder="Ketik ulasan di sini..."
  ></textarea>

  <!-- Button Analyze -->
  <button
    onclick="analyzeText()"
    id="analyzeBtn"
    class="bg-orange-500 hover:bg-orange-700 text-white font-bold py-2 px-4 rounded mt-4 w-full transition duration-300"
  >
    Analyze
  </button>

  <!-- Loader -->
  <div id="loader" class="text-center mt-4 hidden">
    <svg
      class="animate-spin h-6 w-6 text-orange-600 mx-auto"
      viewBox="0 0 24 24"
    >
      <circle
        class="opacity-25"
        cx="12"
        cy="12"
        r="10"
        stroke="currentColor"
        stroke-width="4"
      ></circle>
      <path
        class="opacity-75"
        fill="currentColor"
        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"
      ></path>
    </svg>
  </div>

  <!-- Hasil Analisis -->
  <div id="analysisResult" class="mt-6 hidden">
    <h3 class="text-lg font-semibold text-gray-700">Hasil Analisis:</h3>
    <div class="flex flex-wrap gap-4 mt-2" id="aspectsContainer">
      <!-- Aspek dan Sentimen akan ditampilkan di sini -->
    </div>
  </div>
</div>

<script>
  async function analyzeText() {
    let review = document.getElementById("reviewText").value.trim();
    if (!review) {
      alert("Masukkan teks ulasan terlebih dahulu.");
      return;
    }

    // Tampilkan loader
    document.getElementById("loader").classList.remove("hidden");

    try {
      let response = await fetch("/api/analyze-text", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ review: review }),
      });

      let data = await response.json();
      console.log(data); // Debug hasil dari API

      let container = document.getElementById("aspectsContainer");
      container.innerHTML = "";

      if (data.aspects.length === 0) {
        container.innerHTML =
          "<p class='text-gray-500'>Tidak ada aspek yang terdeteksi.</p>";
      } else {
        data.aspects.forEach((aspek) => {
          let bgColor =
            aspek.sentimen === "Positive"
              ? "bg-green-200 text-green-700"
              : "bg-red-200 text-red-700";
          container.innerHTML += `
            <div class="p-4 border rounded shadow ${bgColor}">
                <h4 class="font-semibold">${aspek.name}</h4>
                <span class="block text-sm">${aspek.sentimen}</span>
            </div>
          `;
        });
      }

      // Tampilkan hasil analisis
      document.getElementById("analysisResult").classList.remove("hidden");
    } catch (error) {
      console.error("Error:", error);
      alert("Terjadi kesalahan saat menganalisis. Coba lagi.");
    } finally {
      // Sembunyikan loader
      document.getElementById("loader").classList.add("hidden");
    }
  }
</script>

{% endblock %}
